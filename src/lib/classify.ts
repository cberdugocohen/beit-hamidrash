/**
 * Auto-classify a video title into a topic.
 * Same logic as the Python script, ported to TypeScript.
 */

const PREFIX_TOPICS: [string, string][] = [
  ["יסודות העבודה מתוך לימוד הדרש", "יסודות העבודה מתוך לימוד הדרש"],
  ["להבין - עבודת הקורבנות", "עבודת הקורבנות"],
  ["להבין   עבודת הקורבנות", "עבודת הקורבנות"],
  ["להבין - ביאור עבודת הקורבנות", "עבודת הקורבנות"],
  ['"להבין" - ביאור עבודת הקורבנות', "עבודת הקורבנות"],
  ['להבין" - ביאור עבודת הקורבן', "עבודת הקורבנות"],
  ["זוהר בראשית ופרשת השבוע", "זוהר בראשית ופרשת השבוע"],
  ["תלמוד עשר הספירות חלק א' פרק ראשון", "תלמוד עשר הספירות"],
  ["תלמוד עשר הספירות", "תלמוד עשר הספירות"],
  ["מסילת ישרים + דרך עץ החיים", "מסילת ישרים + דרך עץ החיים"],
  ["מסילת ישרים", "מסילת ישרים"],
  ["דרך עץ החיים -", "דרך עץ החיים"],
];

const CONTAINS_TOPICS: [string, string][] = [
  ["הקדמה לספר הזוהר ותלמוד עשר ספירות", "הקדמה לספר הזוהר ותלמוד עשר ספירות"],
  ["הקדמה לספר הזוהר", "הקדמה לספר הזוהר"],
  ["פתיחה לחכמת הקבלה", "פתיחה לחכמת הקבלה"],
  ["משמר זוהר ליל שישי", "משמר זוהר ליל שישי"],
  ["ליל משמר", "משמר זוהר ליל שישי"],
  ["משמר פרשת", "משמר זוהר ליל שישי"],
  ["המאור עיניים", "המאור עיניים"],
  ["מאור עיניים", "המאור עיניים"],
  ["הנתיבות שלום", "הנתיבות שלום"],
  ["נתיבות שלום", "הנתיבות שלום"],
  ["מאור ושמש", "מאור ושמש"],
  ["תהליכי התפתחות התודעה", "תהליכי התפתחות התודעה"],
  ["לימוד חסידות - דרך עץ החיים", 'דרך עץ החיים הרמח"ל'],
  ["לימוד חסידות מיוחד", "לימוד חסידות"],
  ["על פי החסידות", "פרשת שבוע על פי החסידות"],
  ['עפ"י החסידות', "פרשת שבוע על פי החסידות"],
  ["עפ''י החסידות", "פרשת שבוע על פי החסידות"],
  ["לפי החסידות", "פרשת שבוע על פי החסידות"],
  ["מסע רוחני לחודש אלול", "מסע חודש אלול"],
  ["מסע חודש אלול", "מסע חודש אלול"],
  ["אסף פלג חודש אלול", "מסע חודש אלול"],
  ["הכנה לחודש אלול", "מסע חודש אלול"],
  ["מסע הכנה רוחני לראש השנה", "הכנה לראש השנה"],
  ["מסע הכנה רוחני לעשרת ימי תשובה", "עשרת ימי תשובה"],
  ["עשרת ימי תשובה", "עשרת ימי תשובה"],
  ["עבודת ימי השובבים", "עבודת ימי השובבים"],
  ["עבודת ימי השובבי", "עבודת ימי השובבים"],
  ["תורת ימי השובבים", "עבודת ימי השובבים"],
  ["תיקון ימי השובבים", "עבודת ימי השובבים"],
  ["שובבים", "עבודת ימי השובבים"],
  ["דרש פרשת", "דרש פרשת השבוע"],
  ["דרש - פרשת", "דרש פרשת השבוע"],
  ["דרש  פרשת", "דרש פרשת השבוע"],
  ["דרש ויקהל", "דרש פרשת השבוע"],
  ["דרש ראש חודש", "דרש פרשת השבוע"],
  ["דרש חודש", "דרש פרשת השבוע"],
  ["ספירת העומר", "ספירת העומר"],
  ["חנוכה", "חנוכה"],
  ["פורים", "פורים"],
  ["תענית אסתר", "פורים"],
  ["פסח", "פסח"],
  ["סוכות", "סוכות"],
  ["הושענא רבה", "סוכות"],
  ["שמחת תורה", "סוכות"],
  ["שבועות", "שבועות"],
  ["ראש השנה", "ראש השנה"],
  ["יום הכיפורים", "יום הכיפורים"],
  ["יום כיפור", "יום הכיפורים"],
  ["ט' באב", "ט' באב"],
  ["ט באב", "ט' באב"],
  ["שבת חזון", "ט' באב"],
  ["מגילת איכה", "ט' באב"],
  ['ל"ג בעומר', 'ל"ג בעומר'],
  ["לג בעומר", 'ל"ג בעומר'],
  ['ט"ו בשבט', 'ט"ו בשבט'],
  ["ליקוטי מוהר", 'ליקוטי מוהר"ן'],
  ["פרק שירה", "פרק שירה"],
  ["מפגש ראש חודש", "מפגשי קהילה"],
  ["מפגש קהילה", "מפגשי קהילה"],
  ["מפגש היכרות", "מפגשי קהילה"],
  ["כולנו יחד", "מפגשי קהילה"],
  ["כנס כולנו", "מפגשי קהילה"],
  ["שותפים לצמיחה", "מפגשי קהילה"],
  ["קשר השותפות", "מפגשי קהילה"],
  ["שאלות ותשובות", "מפגשי קהילה"],
  ["אחדות עם ישראל", "מפגשי קהילה"],
  ["הכנה לחודש ניסן", "הכנה לחודש ניסן"],
  ["לימוד ליל שישי", "לימוד ליל שישי"],
  ["פדיון שבויים", "שיעורים מיוחדים"],
  ["שידור חי", "שיעורים מיוחדים"],
];

export function classifyTopic(title: string): string {
  const t = title.trim();

  for (const [prefix, topic] of PREFIX_TOPICS) {
    if (t.startsWith(prefix)) return topic;
  }

  for (const [pattern, topic] of CONTAINS_TOPICS) {
    if (t.includes(pattern)) return topic;
  }

  if (/^פרשת\s+\S+/.test(t)) return "פרשת השבוע";

  return "שיעורים כלליים";
}
